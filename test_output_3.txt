
> sdd-bundle-editor@0.0.0 test:e2e /home/ivan/dev/sdd-bundle-editor
> playwright test "e2e/agent-editing.spec.ts"

[2m[WebServer] [22m{"level":30,"time":1765120563250,"pid":14365,"hostname":"ASUSMAIN","msg":"Server listening at http://10.255.255.254:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120563251,"pid":14365,"hostname":"ASUSMAIN","msg":"Server listening at http://127.0.0.1:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120563251,"pid":14365,"hostname":"ASUSMAIN","msg":"Server listening at http://192.168.242.165:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120563805,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-1","req":{"method":"GET","url":"/health","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":58648},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120563809,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-1","res":{"statusCode":200},"responseTime":3.68258298933506,"msg":"request completed"}
[2m[WebServer] [22m
[2m[WebServer] [22m> @sdd-bundle-editor/web@0.0.0 dev /home/ivan/dev/sdd-bundle-editor/apps/web
[2m[WebServer] [22m> webpack serve --config webpack.config.js
[2m[WebServer] [22m
[2m[WebServer] [22m<i> [webpack-dev-server] [HPM] Proxy created: /bundle,/bundle/validate,/bundle/save,/ai/generate,/ai/fix-errors,/agent  -> http://localhost:3000
[2m[WebServer] [22m<i> [webpack-dev-server] Project is running at:
[2m[WebServer] [22m<i> [webpack-dev-server] Loopback: [36mhttp://localhost:5173/[39m, [36mhttp://[::1]:5173/[39m
[2m[WebServer] [22m<i> [webpack-dev-server] On Your Network (IPv4): [36mhttp://192.168.242.165:5173/[39m
[2m[WebServer] [22m<i> [webpack-dev-server] Content not from webpack is served from '[36m/home/ivan/dev/sdd-bundle-editor/apps/web/public[39m' directory
[2m[WebServer] [22m<i> [webpack-dev-server] 404s will fallback to '[36m/index.html[39m'
[2m[WebServer] [22m<i> [webpack-dev-middleware] wait until bundle finished: /
[2m[WebServer] [22masset [1m[32mbundle.js[39m[22m 4.14 MiB [1m[32m[emitted][39m[22m (name: main)
[2m[WebServer] [22masset [1m[32mindex.html[39m[22m 662 bytes [1m[32m[emitted][39m[22m
[2m[WebServer] [22morphan modules 32.7 KiB [1m[33m[orphan][39m[22m 22 modules
[2m[WebServer] [22mruntime modules 27.1 KiB 14 modules
[2m[WebServer] [22mmodules by path [1m../../node_modules/.pnpm/[39m[22m 2.8 MiB
[2m[WebServer] [22m  javascript modules 2.8 MiB 826 modules
[2m[WebServer] [22m  json modules 3.07 KiB 2 modules
[2m[WebServer] [22mmodules by path [1m../../packages/ui-shell/dist/[39m[22m 50.4 KiB
[2m[WebServer] [22m  modules by path [1m../../packages/ui-shell/dist/components/*.js[39m[22m 34.1 KiB 7 modules
[2m[WebServer] [22m  modules by path [1m../../packages/ui-shell/dist/*.js[39m[22m 16.3 KiB
[2m[WebServer] [22m    [1m../../packages/ui-shell/dist/index.js[39m[22m 974 bytes [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m    + 2 modules
[2m[WebServer] [22mmodules by path [1m./src/[39m[22m 39.3 KiB
[2m[WebServer] [22m  [1m./src/index.tsx[39m[22m 705 bytes [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m  [1m./src/styles.css[39m[22m 2.92 KiB [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m  ../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0_webpack-cli@5.1.4_/node_modules/css-loader/dist/cjs.js![1m./src/styles.css[39m[22m 35.6 KiB [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22mwebpack 5.103.0 compiled [1m[32msuccessfully[39m[22m in 3865 ms

Running 1 test using 1 worker

Test bundle dir: /tmp/sdd-test-3zIt4i
[2m[WebServer] [22m(node:14419) [DEP0060] DeprecationWarning: The `util._extend` API is deprecated. Please use Object.assign() instead.
[2m[WebServer] [22m(Use `node --trace-deprecation ...` to show where the warning was created)
[2m[WebServer] [22m{"level":30,"time":1765120570115,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-2","req":{"method":"POST","url":"/agent/config","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44246},"msg":"incoming request"}
[2m[WebServer] [22mAgentService initialized with backend: mock
[2m[WebServer] [22mReconfiguring AgentService with backend: mock
[2m[WebServer] [22mUpdated .env configuration
[2m[WebServer] [22m{"level":30,"time":1765120570123,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-2","res":{"statusCode":200},"responseTime":7.193244993686676,"msg":"request completed"}
BROWSER LOG: [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
BROWSER LOG: [HMR] Waiting for update signal from WDS...
BROWSER LOG: %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold
[2m[WebServer] [22m{"level":30,"time":1765120570604,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-3","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44252},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570604,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-3","res":{"statusCode":200},"responseTime":0.692332997918129,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570606,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-4","req":{"method":"GET","url":"/bundle?bundleDir=%2Ftmp%2Fsdd-test-3zIt4i","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44260},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570623,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-5","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44274},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570624,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-5","res":{"statusCode":200},"responseTime":0.39899399876594543,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570629,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-6","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44278},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570630,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-6","res":{"statusCode":200},"responseTime":0.48006299138069153,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570635,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-7","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44294},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570635,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-7","res":{"statusCode":200},"responseTime":0.6178189963102341,"msg":"request completed"}
BROWSER LOG: handleAgentStart called, readOnly: true
[2m[WebServer] [22m{"level":30,"time":1765120570728,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-8","req":{"method":"POST","url":"/agent/start","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44298},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570729,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-8","res":{"statusCode":200},"responseTime":1.3682339936494827,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570754,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-4","res":{"statusCode":200},"responseTime":147.97021900117397,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570760,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-9","req":{"method":"GET","url":"/bundle?bundleDir=%2Ftmp%2Fsdd-test-3zIt4i","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44314},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120570838,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-9","res":{"statusCode":200},"responseTime":78.27809000015259,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120570840,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-a","req":{"method":"POST","url":"/agent/message","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44320},"msg":"incoming request"}
[2m[WebServer] [22mMockAgentBackend: Triggering proposal logic for message: propose change
[2m[WebServer] [22m{"level":30,"time":1765120570841,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-a","res":{"statusCode":200},"responseTime":1.195156991481781,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120571173,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-b","req":{"method":"POST","url":"/agent/accept?bundleDir=%2Ftmp%2Fsdd-test-3zIt4i","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44326},"msg":"incoming request"}
Last message: I have proposed a change to update the profile title.
[2m[WebServer] [22m{"level":30,"time":1765120571251,"pid":14365,"hostname":"ASUSMAIN","reqId":"req-b","res":{"statusCode":400},"responseTime":77.31094300746918,"msg":"request completed"}
BROWSER LOG: Failed to load resource: the server responded with a status of 400 (Bad Request)
BROWSER LOG: Error: {"error":"Failed to apply change: Entity user not found in bundle."}
    at fetchJson (webpack://@sdd-bundle-editor/web/../../packages/ui-shell/dist/AppShell.js?:19:15)
    at async handleAgentAccept (webpack://@sdd-bundle-editor/web/../../packages/ui-shell/dist/AppShell.js?:224:26)
  âœ˜  1 [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes (11.2s)


  1) [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.message-content').last().getByText('Changes applied successfully.')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.message-content').last().getByText('Changes applied successfully.')[22m


      101 |             console.log('Last message:', await lastMessage.innerText());
      102 |         }
    > 103 |         await expect(lastMessage.getByText('Changes applied successfully.', { exact: false })).toBeVisible();
          |                                                                                                ^
      104 |
      105 |         // 9. Verify File on Disk
      106 |         const entitiesDir = path.join(tempDir, 'entities/Profile');
        at /home/ivan/dev/sdd-bundle-editor/e2e/agent-editing.spec.ts:103:96

    Error Context: test-results/agent-editing-Agent-Editin-2fcd0-d-propose-and-apply-changes-chromium/error-context.md

  1 failed
    [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes 
â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
