
> sdd-bundle-editor@0.0.0 test:e2e /home/ivan/dev/sdd-bundle-editor
> playwright test "e2e/agent-editing.spec.ts"

[2m[WebServer] [22m{"level":30,"time":1765120359944,"pid":11673,"hostname":"ASUSMAIN","msg":"Server listening at http://10.255.255.254:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120359944,"pid":11673,"hostname":"ASUSMAIN","msg":"Server listening at http://127.0.0.1:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120359944,"pid":11673,"hostname":"ASUSMAIN","msg":"Server listening at http://192.168.242.165:3000"}
[2m[WebServer] [22m{"level":30,"time":1765120360213,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-1","req":{"method":"GET","url":"/health","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":44982},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120360218,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-1","res":{"statusCode":200},"responseTime":4.331750988960266,"msg":"request completed"}
[2m[WebServer] [22m
[2m[WebServer] [22m> @sdd-bundle-editor/web@0.0.0 dev /home/ivan/dev/sdd-bundle-editor/apps/web
[2m[WebServer] [22m> webpack serve --config webpack.config.js
[2m[WebServer] [22m
[2m[WebServer] [22m<i> [webpack-dev-server] [HPM] Proxy created: /bundle,/bundle/validate,/bundle/save,/ai/generate,/ai/fix-errors,/agent  -> http://localhost:3000
[2m[WebServer] [22m<i> [webpack-dev-server] Project is running at:
[2m[WebServer] [22m<i> [webpack-dev-server] Loopback: [36mhttp://localhost:5173/[39m, [36mhttp://[::1]:5173/[39m
[2m[WebServer] [22m<i> [webpack-dev-server] On Your Network (IPv4): [36mhttp://192.168.242.165:5173/[39m
[2m[WebServer] [22m<i> [webpack-dev-server] Content not from webpack is served from '[36m/home/ivan/dev/sdd-bundle-editor/apps/web/public[39m' directory
[2m[WebServer] [22m<i> [webpack-dev-server] 404s will fallback to '[36m/index.html[39m'
[2m[WebServer] [22m<i> [webpack-dev-middleware] wait until bundle finished: /
[2m[WebServer] [22masset [1m[32mbundle.js[39m[22m 4.14 MiB [1m[32m[emitted][39m[22m (name: main)
[2m[WebServer] [22masset [1m[32mindex.html[39m[22m 662 bytes [1m[32m[emitted][39m[22m
[2m[WebServer] [22morphan modules 32.7 KiB [1m[33m[orphan][39m[22m 22 modules
[2m[WebServer] [22mruntime modules 27.1 KiB 14 modules
[2m[WebServer] [22mmodules by path [1m../../node_modules/.pnpm/[39m[22m 2.8 MiB
[2m[WebServer] [22m  javascript modules 2.8 MiB 826 modules
[2m[WebServer] [22m  json modules 3.07 KiB 2 modules
[2m[WebServer] [22mmodules by path [1m../../packages/ui-shell/dist/[39m[22m 50.3 KiB
[2m[WebServer] [22m  modules by path [1m../../packages/ui-shell/dist/components/*.js[39m[22m 34.1 KiB 7 modules
[2m[WebServer] [22m  modules by path [1m../../packages/ui-shell/dist/*.js[39m[22m 16.3 KiB
[2m[WebServer] [22m    [1m../../packages/ui-shell/dist/index.js[39m[22m 974 bytes [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m    + 2 modules
[2m[WebServer] [22mmodules by path [1m./src/[39m[22m 39.3 KiB
[2m[WebServer] [22m  [1m./src/index.tsx[39m[22m 705 bytes [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m  [1m./src/styles.css[39m[22m 2.92 KiB [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22m  ../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0_webpack-cli@5.1.4_/node_modules/css-loader/dist/cjs.js![1m./src/styles.css[39m[22m 35.6 KiB [1m[33m[built][39m[22m [1m[33m[code generated][39m[22m
[2m[WebServer] [22mwebpack 5.103.0 compiled [1m[32msuccessfully[39m[22m in 3716 ms

Running 1 test using 1 worker

Test bundle dir: /tmp/sdd-test-q8XDQo
[2m[WebServer] [22m(node:11747) [DEP0060] DeprecationWarning: The `util._extend` API is deprecated. Please use Object.assign() instead.
[2m[WebServer] [22m(Use `node --trace-deprecation ...` to show where the warning was created)
[2m[WebServer] [22m{"level":30,"time":1765120366535,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-2","req":{"method":"POST","url":"/agent/config","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57282},"msg":"incoming request"}
[2m[WebServer] [22mAgentService initialized with backend: mock
[2m[WebServer] [22mReconfiguring AgentService with backend: mock
[2m[WebServer] [22mUpdated .env configuration
[2m[WebServer] [22m{"level":30,"time":1765120366543,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-2","res":{"statusCode":200},"responseTime":8.34808400273323,"msg":"request completed"}
BROWSER LOG: [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
BROWSER LOG: [HMR] Waiting for update signal from WDS...
BROWSER LOG: %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold
[2m[WebServer] [22m{"level":30,"time":1765120367005,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-3","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57284},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367006,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-3","res":{"statusCode":200},"responseTime":0.8153659999370575,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367008,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-4","req":{"method":"GET","url":"/bundle?bundleDir=%2Ftmp%2Fsdd-test-q8XDQo","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57286},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367023,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-5","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57292},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367024,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-5","res":{"statusCode":200},"responseTime":0.8939300030469894,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367028,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-6","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57300},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367029,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-6","res":{"statusCode":200},"responseTime":0.43595100939273834,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367036,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-7","req":{"method":"GET","url":"/agent/status","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57306},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367037,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-7","res":{"statusCode":200},"responseTime":0.4457100033760071,"msg":"request completed"}
BROWSER LOG: handleAgentStart called, readOnly: true
[2m[WebServer] [22m{"level":30,"time":1765120367124,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-8","req":{"method":"POST","url":"/agent/start","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57314},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367126,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-8","res":{"statusCode":200},"responseTime":1.6539210081100464,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367154,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-4","res":{"statusCode":200},"responseTime":145.59066300094128,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367160,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-9","req":{"method":"GET","url":"/bundle?bundleDir=%2Ftmp%2Fsdd-test-q8XDQo","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57322},"msg":"incoming request"}
[2m[WebServer] [22m{"level":30,"time":1765120367234,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-9","res":{"statusCode":200},"responseTime":73.56168501079082,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367299,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-a","req":{"method":"POST","url":"/agent/message","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57334},"msg":"incoming request"}
[2m[WebServer] [22mMockAgentBackend: Triggering proposal logic for message: propose change
[2m[WebServer] [22m{"level":30,"time":1765120367300,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-a","res":{"statusCode":200},"responseTime":1.1748929917812347,"msg":"request completed"}
[2m[WebServer] [22m{"level":30,"time":1765120367631,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-b","req":{"method":"POST","url":"/agent/accept","host":"localhost:3000","remoteAddress":"127.0.0.1","remotePort":57346},"msg":"incoming request"}
[2m[WebServer] [22m{"level":50,"time":1765120367632,"pid":11673,"hostname":"ASUSMAIN","err":{"type":"Error","message":"sdd-bundle.yaml not found in /home/ivan/dev/sdd-bundle-editor","stack":"Error: sdd-bundle.yaml not found in /home/ivan/dev/sdd-bundle-editor\n    at resolveBundleDir (/home/ivan/dev/sdd-bundle-editor/apps/server/src/routes/agent.ts:14:15)\n    at async Object.<anonymous> (/home/ivan/dev/sdd-bundle-editor/apps/server/src/routes/agent.ts:82:31)"},"msg":"sdd-bundle.yaml not found in /home/ivan/dev/sdd-bundle-editor"}
[2m[WebServer] [22m{"level":30,"time":1765120367638,"pid":11673,"hostname":"ASUSMAIN","reqId":"req-b","res":{"statusCode":400},"responseTime":6.638961002230644,"msg":"request completed"}
BROWSER LOG: Failed to load resource: the server responded with a status of 400 (Bad Request)
BROWSER LOG: Error: {"error":"sdd-bundle.yaml not found in /home/ivan/dev/sdd-bundle-editor"}
    at fetchJson (webpack://@sdd-bundle-editor/web/../../packages/ui-shell/dist/AppShell.js?:19:15)
    at async handleAgentAccept (webpack://@sdd-bundle-editor/web/../../packages/ui-shell/dist/AppShell.js?:224:26)
Last message: I have proposed a change to update the profile title.
  âœ˜  1 [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes (11.2s)


  1) [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.message-content').last().getByText('Changes applied successfully.')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.message-content').last().getByText('Changes applied successfully.')[22m


      101 |             console.log('Last message:', await lastMessage.innerText());
      102 |         }
    > 103 |         await expect(lastMessage.getByText('Changes applied successfully.', { exact: false })).toBeVisible();
          |                                                                                                ^
      104 |
      105 |         // 9. Verify File on Disk
      106 |         const entitiesDir = path.join(tempDir, 'entities/Profile');
        at /home/ivan/dev/sdd-bundle-editor/e2e/agent-editing.spec.ts:103:96

    Error Context: test-results/agent-editing-Agent-Editin-2fcd0-d-propose-and-apply-changes-chromium/error-context.md

  1 failed
    [chromium] â€º e2e/agent-editing.spec.ts:40:9 â€º Agent Editing Flow â€º should propose and apply changes 
â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
